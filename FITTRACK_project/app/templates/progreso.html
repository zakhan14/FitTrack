{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Gráfico de Rendimiento</title>
  <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
  <link rel="icon" href="{% static 'images/logo.png' %}">
  <link rel="stylesheet" href="{% static 'css/progress.css' %}" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
</head>
<body>
  <header class="navbar">
    <div class="navbar-left">
      <a href="{% url 'index' %}"><h1>FTR</h1></a>
    </div>

    <nav class="navbar-center">
      <a href="{% url 'index' %}">Inicio</a>
      <a href="{% url 'entrenamiento' %}">Entrenamiento</a>
    </nav>

    <div class="navbar-right">
      <a href="{% url 'custom_logout' %}" class="btn">Log Out</a>
    </div>
  </header>

  <h2 style="text-align: left; margin-left: 26%;">Introduce tus valores</h2>
  <div id="contenedor-formulario-grafico">
    <form method="post" id="calcForm">
      {% csrf_token %}
      {{ form.as_p }}
      <button type="submit" name="guardar">Guardar nueva medición</button>
      <button type="submit" name="comparar">Comparar</button>
    </form>
    {{ chart_data|json_script:"chart-data" }}
  </div>

  <!-- Contenedor para el gráfico -->
  <div id="radarChart" style="width: 100%; max-width: 600px; height: 400px; margin: auto;"></div>

  <script>
    // Obtener datos del contexto Django
    const chartData = JSON.parse(document.getElementById('chart-data').textContent);

    // Construimos indicadores y datos para el radar
    const indicators = [
      { name: 'Altura', max: 250 },
      { name: 'Peso', max: 200 },
      { name: 'Grasa Corporal', max: 50 },
      { name: 'Masa Muscular', max: 100 },
      { name: 'Líquido Corporal', max: 70 }
    ];

    // Mapear chartData para formato radar
    // En chartData vienen uno o dos objetos con las medidas para comparar
    const dataRadar = chartData.map(entry => [
      entry.height || 0,
      entry.weight || 0,
      entry.grasa_corporal || 0,
      entry.masa_muscular || 0,
      entry.liquido_corporal || 0
    ]);

    // Etiquetas para la leyenda: fechas o 'Formulario (sin guardar)'
    const labels = chartData.map(entry => entry.fecha);

    const option = {
      backgroundColor: '#161627',
      title: {
        text: 'Progreso corporal',
        left: 'center',
        textStyle: { color: '#eee' }
      },
      legend: {
        bottom: 5,
        data: labels,
        textStyle: { color: '#fff', fontSize: 14 }
      },
      radar: {
        indicator: indicators,
        shape: 'circle',
        splitNumber: 5,
        axisName: { color: 'rgb(238, 197, 102)' },
        splitLine: {
          lineStyle: {
            color: [
              'rgba(238, 197, 102, 0.1)',
              'rgba(238, 197, 102, 0.2)',
              'rgba(238, 197, 102, 0.4)',
              'rgba(238, 197, 102, 0.6)',
              'rgba(238, 197, 102, 0.8)',
              'rgba(238, 197, 102, 1)'
            ].reverse()
          }
        },
        splitArea: { show: false },
        axisLine: {
          lineStyle: { color: 'rgba(238, 197, 102, 0.5)' }
        }
      },
      series: dataRadar.map((data, idx) => ({
        name: labels[idx],
        type: 'radar',
        data: [data],
        areaStyle: { opacity: 0.5 },
        lineStyle: { width: 1, opacity: 0.5 },
        symbol: 'none',
        itemStyle: {
          color: idx === 0 ? '#B3E4A1' : 'rgb(238, 197, 102)'
        }
      }))
    };

    const myChart = echarts.init(document.getElementById('radarChart'));
    myChart.setOption(option);
  </script>

  <footer class="footer">
    <div class="footer-left">
      <img src="{% static 'images/logo.png' %}" alt="Logo" class="logo">
      <div class="social-icons">
        <a href="https://www.facebook.com/ZukaKhantadze" target="_blank" aria-label="Facebook">
          <i class="fab fa-facebook-f"></i>
        </a>
        <a href="https://www.tiktok.com/@_zakhan_" target="_blank" aria-label="TikTok">
          <i class="fab fa-tiktok"></i>
        </a>
        <a href="https://www.instagram.com/_zakhan_" target="_blank" aria-label="Instagram">
          <i class="fab fa-instagram"></i>
        </a>
      </div>
    </div>
    <div class="footer-columns">
      <div class="footer-column">
        <h4>Contacto</h4>
        <p>contacto@fittracker.com</p>
        <p>+34 012 456 789</p>
      </div>
      <div class="footer-column">
        <h4>Dirección</h4>
        <p>Calle Inexistente 13</p>
        <p>Madrid, España</p>
      </div>
      <div class="footer-column">
        <h4>Redes Sociales</h4>
        <p>Síguenos en Facebook, <br>TikTok e Instagram.</p>
      </div>
    </div>
  </footer>
</body>
</html>
